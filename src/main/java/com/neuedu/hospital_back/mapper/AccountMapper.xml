<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neuedu.hospital_back.mapper.AccountMapper">

    <insert id="insert" keyColumn="accId" keyProperty="accId" useGeneratedKeys="true">
        insert into account (dId, uId, payTime, fee, feeType, payType, rId, cId, postDId)
        values (#{dId}, #{uId}, #{payTime}, #{fee}, #{feeType}, #{payType}, #{rId}, #{cId}, #{postDId})
    </insert>

    <update id="updateUId">
        update account a JOIN account_examinationapplication ae on a.accId = ae.accId
        set uId = #{uId} where  rId = #{rId} and ae.eAId = #{eAId}
    </update>

    <select id="getMedicineByRIdAndTime" resultType="com.neuedu.hospital_back.po.Medicine">
        select medicine.mId, mCode, mName, mSpell, mSpecification, mUnit, mProducer,mFormulation, mType, mFee, dia_M_Id,instruction,
      dosage, times,mAmount,mState from medicine,diagnosis_medicine,account,account_diagnosis
      where rId=#{rId} and FROM_UNIXTIME(payTime,'%Y-%m-%d')=#{time} and feeType in ("西药","中药")and account_diagnosis.dia_M_Id=diagnosis_medicine.dia_M_Id
      and medicine.mId=diagnosis_medicine.mId and account.accId=account_diagnosis.accId
      and mState="已收费"

    </select>
</mapper>